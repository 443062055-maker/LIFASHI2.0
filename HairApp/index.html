<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iäººç”·å£«ç†å‘æ²Ÿé€šå¡ç”Ÿæˆå™¨</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—ä½“ä½œä¸ºé»˜è®¤ï¼Œå¹¶å›é€€åˆ°ç³»ç»Ÿä¸­æ–‡å®‹ä½“/é»‘ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', 'Microsoft YaHei', 'SimHei', sans-serif;
            background-color: #f7f9fb;
        }
        /* éšè—æ»šåŠ¨æ¡ç¾åŒ– */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .step-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .step-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        .selected-style {
            border: 3px solid #3b82f6 !important; /* å¼ºè°ƒé€‰ä¸­çŠ¶æ€ */
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.3);
        }
        .face-card:hover {
            background-color: #f9fafb;
        }
        /* é”å®šå‘å‹é€‰æ‹©åŒºåŸŸçš„æ ·å¼ */
        .locked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(2px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 0.75rem; /* rounded-xl */
            text-align: center;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">Iäººç”·å£«ç†å‘å¸ˆæ²Ÿé€šå·¥å…· âœ‚ï¸</h1>
            <p class="text-xl text-gray-500">ä¸å†éœ€è¦å°´å°¬çš„æ²‰é»˜ã€‚ç”¨ä¸€å¼ å¡ç‰‡æ¸…æ™°è¡¨è¾¾ä½ çš„éœ€æ±‚ã€‚</p>
        </header>

        <main id="app-container" class="space-y-12">
            
            <!-- æ­¥éª¤ 1: å½“å‰å¤´å‘é•¿åº¦è¾“å…¥ -->
            <div id="step-1" class="step-card bg-white p-6 md:p-8 rounded-xl">
                <h2 class="text-2xl font-bold text-blue-600 mb-4">1. æˆ‘çš„ç°çŠ¶ï¼šå½“å‰å¤´å‘é•¿åº¦ (å˜ç±³)</h2>
                <p class="text-sm text-gray-500 mb-6">è¯·ä¼°è®¡æ‚¨çš„ä¸»è¦åŒºåŸŸå¤´å‘é•¿åº¦ã€‚è‹¥ä¸ç¡®å®šï¼Œå¯å‚è€ƒæ‰‹æŒ‡å…³èŠ‚é•¿åº¦ã€‚</p>
                
                <div class="space-y-6">
                    <div>
                        <label for="current-fringe" class="block text-gray-700 font-medium mb-2">åˆ˜æµ·é•¿åº¦ (Fringe)</label>
                        <input type="range" id="current-fringe" min="1" max="15" value="5" oninput="updateLengthDisplay('fringe')" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <span id="display-fringe" class="text-lg font-semibold text-gray-800 mt-1 block">5 cm</span>
                    </div>
                    <div>
                        <label for="current-top" class="block text-gray-700 font-medium mb-2">é¡¶éƒ¨é•¿åº¦ (Top)</label>
                        <input type="range" id="current-top" min="3" max="20" value="8" oninput="updateLengthDisplay('top')" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <span id="display-top" class="text-lg font-semibold text-gray-800 mt-1 block">8 cm</span>
                    </div>
                    <div>
                        <label for="current-sides" class="block text-gray-700 font-medium mb-2">ä¸¤ä¾§é•¿åº¦ (Sides)</label>
                        <input type="range" id="current-sides" min="0.5" max="6" step="0.5" value="2" oninput="updateLengthDisplay('sides')" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <span id="display-sides" class="text-lg font-semibold text-gray-800 mt-1 block">2 cm</span>
                    </div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 2: è„¸å‹è‡ªæµ‹ä¸é€‰æ‹© (åŸ Step 1.5) -->
            <div id="step-2-face-shape" class="step-card bg-white p-6 md:p-8 rounded-xl">
                <h2 class="text-2xl font-bold text-blue-600 mb-4">2. æˆ‘çš„è„¸å‹ï¼šè‡ªæµ‹ä¸é€‰æ‹© ğŸ“</h2>
                
                <div class="mb-6">
                    <div class="p-4 bg-purple-50 rounded-lg border-2 border-purple-200">
                        <h3 class="font-bold text-xl text-purple-800 mb-2">ğŸ’¡ è„¸å‹è‡ªæµ‹æŒ‡å—</h3>
                        <ul class="list-disc pl-5 space-y-2 text-gray-700 text-sm">
                            <li>è¯·è§‚å¯Ÿæ‚¨çš„è„¸éƒ¨è½®å»“ã€é¢§éª¨å’Œä¸‹é¢Œè§’çš„ç‰¹å¾ã€‚</li>
                            <li>ç‚¹å‡»ä¸‹æ–¹å›¾ç‰‡ï¼Œé€‰æ‹©æœ€æ¥è¿‘æ‚¨çš„è„¸å‹ï¼Œè¿™å°†è§£é”å‘å‹æ¨èã€‚</li>
                            <li><strong class="text-purple-600">æç¤ºï¼šä¸‹æ–¹çš„å›¾ç‰‡æ˜¯æ‚¨æä¾›çš„è„¸å‹å¯¹æ¯”å›¾ï¼Œç‚¹å‡»å¯¹åº”çš„è„¸å‹å¡ç‰‡å³å¯é€‰æ‹©ã€‚</strong></li>
                        </ul>
                    </div>
                </div>

                <!-- è„¸å‹é€‰æ‹©åŒº -->
                <div id="face-shape-gallery" class="grid grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- è„¸å‹å¡ç‰‡å°†ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div id="selected-face-info" class="mt-6 p-4 bg-purple-100 rounded-lg border border-purple-300 hidden">
                    <p class="font-semibold text-purple-800">æ‚¨å·²é€‰æ‹©: <span id="selected-face-name"></span></p>
                    <p class="text-sm text-purple-700 mt-1">è¯·ç»§ç»­ Step 3 é€‰æ‹©é€‚é…çš„å‘å‹ã€‚</p>
                </div>
            </div>

            <!-- æ­¥éª¤ 3: ç›®æ ‡å‘å‹é€‰æ‹© (åŸ Step 2) -->
            <div id="step-3-style" class="step-card bg-white p-6 md:p-8 rounded-xl relative">
                <h2 class="text-2xl font-bold text-blue-600 mb-4">3. æˆ‘çš„ç›®æ ‡ï¼šé€‰æ‹©ç›®æ ‡å‘å‹</h2>
                
                <!-- è„¸å‹æç¤ºåŒº -->
                <div id="style-gallery-prompt" class="mb-4 p-3 bg-red-100 rounded-lg border border-red-300 min-h-12">
                    <p class="text-lg font-bold text-red-600">è¯·å…ˆåœ¨ Step 2 ç¡®è®¤æ‚¨çš„è„¸å‹ï¼Œä»¥ä¾¿æ›´å¥½åœ°é€‰æ‹©å‘å‹ã€‚</p>
                </div>

                <!-- é”å®šå åŠ å±‚ -->
                <div id="style-gallery-lock" class="locked-overlay" style="display: flex;">
                    <p class="text-xl font-bold text-gray-700 bg-white p-4 rounded-lg shadow-xl border border-gray-200">
                        ğŸ”’ è¯·å…ˆåœ¨ Step 2 ä¸­é€‰æ‹©æ‚¨çš„è„¸å‹
                    </p>
                </div>

                <!-- å‘å‹ç”»å»Š (é»˜è®¤éšè—åœ¨é”å®šå±‚ä¸‹æ–¹) -->
                <div id="style-gallery" class="grid grid-cols-2 md:grid-cols-4 gap-4 hide-scrollbar overflow-x-auto pb-4 opacity-30 pointer-events-none">
                    <!-- å‘å‹å¡ç‰‡å°†ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div id="selected-style-info" class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200 hidden">
                    <p class="font-semibold text-blue-700">å·²é€‰æ‹©: <span id="selected-name"></span></p>
                    <p class="text-sm text-blue-600 mt-1">æ‰€éœ€é•¿åº¦: åˆ˜æµ· <span id="required-fringe"></span> / é¡¶éƒ¨ <span id="required-top"></span> / ä¸¤ä¾§ <span id="required-sides"></span></p>
                </div>
            </div>

            <!-- æ­¥éª¤ 4: ç•™é•¿æ—¶é—´é¢„ä¼° (åŸ Step 3) -->
            <div id="step-4-growth" class="step-card bg-white p-6 md:p-8 rounded-xl">
                <h2 class="text-2xl font-bold text-blue-600 mb-4">4. ç•™é•¿é¢„ä¼° (Growth Calculator)</h2>
                <div id="growth-result" class="text-lg font-medium text-gray-700 min-h-6">
                    <p>è¯·å…ˆåœ¨ç¬¬ 3 æ­¥ä¸­é€‰æ‹©ä¸€ä¸ªç›®æ ‡å‘å‹ã€‚</p>
                </div>
                <p class="text-xs text-gray-400 mt-2">ï¼ˆæ³¨ï¼šåŸºäºå¤´å‘å¹³å‡æ¯æœˆç”Ÿé•¿ $1.25\text{ cm}$ ä¼°ç®—ï¼Œç»“æœä»…ä¾›å‚è€ƒã€‚ï¼‰</p>
            </div>

            <!-- æ­¥éª¤ 5: ç†å‘å¸ˆç®€æŠ¥å¡ (åŸ Step 4) -->
            <div id="step-5-briefing" class="step-card bg-white p-6 md:p-8 rounded-xl">
                <h2 class="text-2xl font-bold text-blue-600 mb-4">5. æœ€ç»ˆç®€æŠ¥å¡ (Barber Briefing Card)</h2>
                <p class="text-sm text-gray-500 mb-4">æ‚¨å¯ä»¥ç›´æ¥å±•ç¤ºä»¥ä¸‹å¡ç‰‡ç»™ç†å‘å¸ˆï¼Œå®ç°éå£å¤´æ²Ÿé€šï¼</p>
                
                <div id="briefing-card" class="border-4 border-gray-100 rounded-xl p-6 bg-gray-50 shadow-lg relative min-h-72">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ç†å‘å¸ˆç®€æŠ¥å¡ ğŸ“„</h3>
                    <div id="briefing-content">
                        <!-- ç®€æŠ¥å†…å®¹å°†ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                        <p class="text-center text-gray-400 py-16">è¯·å®Œæˆå‰é¢æ­¥éª¤ä»¥ç”Ÿæˆä½ çš„ç†å‘ç®€æŠ¥ã€‚</p>
                    </div>
                </div>

                <button onclick="copyBriefingContent()" class="mt-6 w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full transition duration-150">
                    ä¸€é”®å¤åˆ¶æ–‡å­—ç®€æŠ¥
                </button>
            </div>

        </main>
        
        <footer class="mt-12 text-center text-gray-400 text-sm">
            <p>Â© 2024 Iäººç†å‘åŠ©æ‰‹. ä¸ºå†…å‘è€…è®¾è®¡ã€‚</p>
        </footer>
    </div>

    <script>
        // å®šä¹‰å‘å‹æ•°æ® (åŒ…å«åç§°ã€æ‰€éœ€é•¿åº¦ã€ç»™ç†å‘å¸ˆçš„ç®€æŠ¥ å’Œ é€‚é…è„¸å‹)
        const HAIRSTYLES = [
            // suitableFaces: 'oval': é¹…è›‹è„¸, 'round': åœ†å½¢è„¸, 'square': æ–¹å½¢è„¸, 'long': é•¿å½¢è„¸, 'diamond': è±å½¢è„¸, 'heart': å¿ƒå½¢è„¸
            { id: 'buzz', name: 'å¯¸å¤´ (Buzz Cut)', img: 'https://placehold.co/400x400/1e40af/ffffff?text=å¯¸å¤´', fringe: 1, top: 1, sides: 0.5, briefing: ['ä¸¤ä¾§å’Œåé¢ˆæ¨è‡³ 0.5cm', 'é¡¶éƒ¨ä¿®å‰ªè‡³ 1cm', 'æ•´ä½“ä¿æŒå¹²å‡€åˆ©è½ã€‚'], suitableFaces: ['oval', 'square', 'diamond'] },
            { id: 'fringe', name: 'éŸ©ç³»åˆ˜æµ·', img: 'https://placehold.co/400x400/fbbf24/000000?text=éŸ©ç³»åˆ˜æµ·', fringe: 12, top: 10, sides: 3, briefing: ['åˆ˜æµ·è¦ä¿ç•™ï¼Œé•¿åº¦éœ€èƒ½é®ä½çœ‰æ¯›ï¼Œå¾®çƒ«æ‰“é€ ç©ºæ°”æ„Ÿ', 'ä¸¤ä¾§ä½¿ç”¨æ¸å˜å‰ªæ³•ï¼Œä¿æŒ 3cm å·¦å³åšåº¦', 'é¡¶éƒ¨ä¿ç•™ 10cm ç”¨äºé€ å‹ã€‚'], suitableFaces: ['long', 'diamond', 'heart', 'oval'] },
            { id: 'sidepart', name: 'ä¸‰ä¸ƒåˆ†èƒŒå¤´', img: 'https://placehold.co/400x400/991b1b/ffffff?text=ä¸‰ä¸ƒåˆ†', fringe: 8, top: 12, sides: 2, briefing: ['åˆ†çº¿å¤„éœ€ä¿®æ•´æ¸…æ™°', 'é¡¶éƒ¨å…¨éƒ¨ä¿ç•™ï¼Œä¿®å‰ªå‘å°¾è®©é€ å‹æ›´æ˜“æ‰“ç†', 'ä¸¤ä¾§æ¸å˜ï¼Œä»é¬“è§’ 2cm æ¨çŸ­ã€‚'], suitableFaces: ['oval', 'round', 'long', 'square'] },
            { id: 'quiff', name: 'é£æœºå¤´ (Quiff)', img: 'https://placehold.co/400x400/059669/ffffff?text=é£æœºå¤´', fringe: 6, top: 8, sides: 1, briefing: ['åˆ˜æµ·å‘ä¸Šæ¢³ç†ï¼Œéœ€è¦è¶³å¤Ÿçš„é•¿åº¦å’Œæ”¯æ’‘åŠ›', 'é¡¶éƒ¨å’Œåˆ˜æµ·è¡”æ¥å¤„ä¿®çŸ­ï¼Œæ‰“é€ å±‚æ¬¡æ„Ÿ', 'ä¸¤ä¾§ä½¿ç”¨æ¨å‰ªï¼Œä¿æŒ 1cm æ¸å±‚ã€‚'], suitableFaces: ['round', 'square', 'oval'] },
            
            // --- æ–°å¢å‘å‹é€‰é¡¹ ---
            { id: 'undercut', name: 'æ¸å±‚æ²¹å¤´ (Undercut)', img: 'https://placehold.co/400x400/f59e0b/ffffff?text=æ¸å±‚æ²¹å¤´', fringe: 10, top: 15, sides: 0.8, briefing: ['é¡¶éƒ¨ä¿ç•™é•¿åº¦ï¼Œç”¨äºåæ¢³æˆ–ä¾§åˆ†é€ å‹', 'ä¸¤ä¾§æ¨å‰ªè‡³ 0.8cmï¼Œä¸é¡¶éƒ¨å½¢æˆæ–­å±‚ï¼ˆä¸è¿æ¥ï¼‰', 'é¬“è§’å’Œåé¢ˆæ”¶ç´§ã€‚'], suitableFaces: ['oval', 'square', 'diamond', 'round'] },
            { id: 'twoblock', name: 'ä¸¤ä¾§é“²é’ (Two Block)', img: 'https://placehold.co/400x400/10b981/ffffff?text=ä¸¤ä¾§é“²é’', fringe: 8, top: 10, sides: 2, briefing: ['åˆ˜æµ·ä¿ç•™é•¿åº¦ï¼Œéœ€ä¿®å‰ªå‡ºå±‚æ¬¡æ„Ÿ', 'é¡¶éƒ¨ä¿ç•™ 10cmï¼Œä¸ä¸¤ä¾§è¡”æ¥å¤„éœ€æ‰“è–„å¤„ç†', 'ä¸¤ä¾§æ¨å‰ªè‡³ 2cmï¼Œå¹²å‡€æ¸…çˆ½ã€‚'], suitableFaces: ['round', 'long', 'heart', 'oval'] },
            { id: 'crop', name: 'æ³•å¼çŸ­å‘ (French Crop)', img: 'https://placehold.co/400x400/ef4444/ffffff?text=æ³•å¼çŸ­å‘', fringe: 4, top: 5, sides: 1.5, briefing: ['åˆ˜æµ·å¹³é½å‰ªçŸ­ï¼Œé•¿åº¦åœ¨é¢å¤´ä¸Šæ–¹çº¦ 4cm', 'é¡¶éƒ¨ä¿®å‰ªå‡ºçº¹ç†æ„Ÿï¼Œä¾¿äºæŠ“é€ å‹', 'ä¸¤ä¾§æ¸å˜æ¨å‰ªè‡³ 1.5cm å·¦å³ã€‚'], suitableFaces: ['oval', 'square', 'long', 'diamond'] },
            { id: 'mullet', name: 'é²»é±¼å¤´ (Modern Mullet)', img: 'https://placehold.co/400x400/6366f1/ffffff?text=é²»é±¼å¤´', fringe: 6, top: 8, sides: 3, briefing: ['å‰é¢å’Œé¡¶éƒ¨ä¿ç•™é•¿åº¦ï¼Œä¿æŒè“¬æ¾', 'ä¸¤ä¾§ä¿®çŸ­ä½†ä¸è¦æ¨é’ï¼Œä¿ç•™ 3cm åšåº¦', 'åé¢ˆå‘å°¾ç•™é•¿å¹¶æ‰“è–„ï¼Œå¼ºè°ƒé²»é±¼å¤´å°¾éƒ¨ç‰¹å¾ã€‚'], suitableFaces: ['oval', 'diamond', 'square'] },
            { id: 'slickback', name: 'ç»å…¸å¤§èƒŒå¤´', img: 'https://placehold.co/400x400/a855f7/ffffff?text=ç»å…¸å¤§èƒŒå¤´', fringe: 15, top: 15, sides: 4, briefing: ['åˆ˜æµ·å’Œé¡¶éƒ¨éœ€è¦è‡³å°‘ 15cm é•¿åº¦ï¼Œå…¨éƒ¨åæ¢³', 'ä¿®å‰ªå‘å°¾è®©å‘è´¨æ›´å¹³é¡ºï¼Œä¾¿äºæ²¹å¤´é€ å‹', 'ä¸¤ä¾§ä¿ç•™ 4cm é•¿åº¦ï¼Œä¸é¡¶éƒ¨è‡ªç„¶è¿æ¥ã€‚'], suitableFaces: ['oval', 'square', 'diamond'] },
        ];
        
        // **æ‚¨ä¸Šä¼ çš„å›¾ç‰‡é“¾æ¥** (åŒ…å«æ‰€æœ‰è„¸å‹å¯¹æ¯”å›¾)
        const FACE_SHAPE_IMAGE_URL = 'uploaded:ç”·ç”Ÿæ€æ ·æ ¹æ®è„¸å‹æ¥é€‰æ‹©é€‚åˆè‡ªå·±çš„å‘å‹ğŸ¤”_1_å½­å·æ¢å¤´å¸ˆé‡é˜³_æ¥è‡ªå°çº¢ä¹¦ç½‘é¡µç‰ˆ.jpg-c5865212-c3a8-40f0-95fe-ad9ea21c3603';


        // è„¸å‹æ•°æ® (æ–°å¢æ¡ˆä¾‹å›¾ç‰‡ URL)
        const FACE_SHAPES = [
            { 
                id: 'oval', name: 'é¹…è›‹è„¸ (Oval)', features: 'é•¿å®½æ¯”çº¦1.5:1ï¼Œè½®å»“æµç•…ï¼Œé€‚é…åº¦æœ€é«˜ã€‚', 
                img: FACE_SHAPE_IMAGE_URL // ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡
            },
            { 
                id: 'round', name: 'åœ†å½¢è„¸ (Round)', features: 'è„¸é•¿â‰ˆè„¸å®½ï¼Œè½¯ç»„ç»‡é¥±æ»¡ï¼Œç¼ºä¹ç«‹ä½“åº¦ã€‚', 
                img: FACE_SHAPE_IMAGE_URL // ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡
            },
            { 
                id: 'square', name: 'æ–¹å½¢è„¸ (Square)', features: 'é¢§éª¨/ä¸‹é¢Œè§’çªå‡ºï¼Œæ£±è§’åˆ†æ˜ï¼Œé˜³åˆšæ°”è´¨çªå‡ºã€‚', 
                img: FACE_SHAPE_IMAGE_URL // ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡
            },
            { 
                id: 'long', name: 'é•¿å½¢è„¸ (Long)', features: 'è„¸é•¿>è„¸å®½1.5å€ï¼Œä¸­åº­/ä¸‹å·´åé•¿ï¼Œè‡ªå¸¦æˆç†Ÿæ„Ÿã€‚', 
                img: FACE_SHAPE_IMAGE_URL // ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡
            },
            { 
                id: 'diamond', name: 'è±å½¢è„¸ (Diamond)', features: 'é¢§éª¨æœ€å®½ï¼Œå¤ªé˜³ç©´/ä¸‹é¢Œå†…æ”¶ï¼Œç•¥æ˜¾åˆ»è–„ã€‚', 
                img: FACE_SHAPE_IMAGE_URL // ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡
            },
            { 
                id: 'heart', name: 'å¿ƒå½¢è„¸ (Heart)', features: 'é¢å®½>é¢§å®½>ä¸‹é¢Œå®½ï¼Œä¸‹å·´è¿‡å°–ï¼Œè‡ªå¸¦ç²¾è‡´æ¼«ç”»æ„Ÿã€‚', 
                img: FACE_SHAPE_IMAGE_URL // ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡
            },
        ];


        // å…¨å±€çŠ¶æ€
        let state = {
            currentFringe: 5,
            currentTop: 8,
            currentSides: 2,
            selectedStyleId: null,
            selectedFaceShape: null, 
        };

        const GROWTH_RATE = 1.25; // å¹³å‡æ¯æœˆç”Ÿé•¿ 1.25 cm

        // --- åˆå§‹åŒ–å‡½æ•° ---

        document.addEventListener('DOMContentLoaded', () => {
            renderFaceShapeGallery(); // æ¸²æŸ“è„¸å‹é€‰æ‹©å™¨
            updateLengthDisplay('fringe');
            updateLengthDisplay('top');
            updateLengthDisplay('sides');
            updateApp(); // é¦–æ¬¡åŠ è½½æ—¶æ›´æ–°æ‰€æœ‰å†…å®¹
        });

        // --- æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---

        // 1. æ›´æ–°é•¿åº¦æ˜¾ç¤ºå¹¶è§¦å‘ App æ›´æ–°
        function updateLengthDisplay(area) {
            const input = document.getElementById(`current-${area}`);
            const display = document.getElementById(`display-${area}`);
            const value = parseFloat(input.value);

            display.textContent = `${value} cm`;
            
            // æ›´æ–°å…¨å±€çŠ¶æ€
            state[`current${area.charAt(0).toUpperCase() + area.slice(1)}`] = value;

            // è§¦å‘æ•´ä½“ App é‡æ–°æ¸²æŸ“ (ç®€æŠ¥å¡å’Œç•™é•¿è®¡ç®—)
            updateApp();
        }

        // 2. æ¸²æŸ“å‘å‹é€‰æ‹©ç”»å»Š (æ–°å¢è¿‡æ»¤é€»è¾‘)
        function renderStyleGallery() {
            const gallery = document.getElementById('style-gallery');
            
            let filteredStyles = HAIRSTYLES;

            // åªæœ‰å½“è„¸å‹è¢«é€‰æ‹©æ—¶æ‰è¿›è¡Œè¿‡æ»¤
            if (state.selectedFaceShape) {
                filteredStyles = HAIRSTYLES.filter(style => 
                    style.suitableFaces.includes(state.selectedFaceShape)
                );
            }
            
            if (filteredStyles.length === 0 && state.selectedFaceShape) {
                gallery.innerHTML = `<p class="text-center text-gray-500 p-8 col-span-full">æŠ±æ­‰ï¼Œç›®å‰æ²¡æœ‰é’ˆå¯¹ ${FACE_SHAPES.find(s => s.id === state.selectedFaceShape).name} çš„å…·ä½“æ¨èå‘å‹ã€‚</p>`;
            } else {
                gallery.innerHTML = filteredStyles.map(style => `
                    <div id="style-${style.id}" 
                         class="style-card border-2 border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-blue-400 transition duration-150 ${state.selectedStyleId === style.id ? 'selected-style' : ''}"
                         onclick="selectStyle('${style.id}')"
                    >
                        <img src="${style.img}" alt="${style.name}" onerror="this.onerror=null;this.src='https://placehold.co/400x400/cccccc/333333?text=${style.name}'" class="w-full h-32 object-cover">
                        <div class="p-3 text-center">
                            <p class="font-semibold text-gray-800">${style.name}</p>
                        </div>
                    </div>
                `).join('');
            }
        }

        // 3. æ¸²æŸ“è„¸å‹é€‰æ‹©ç”»å»Š (åŠ å…¥æ¡ˆä¾‹å›¾)
        function renderFaceShapeGallery() {
            const gallery = document.getElementById('face-shape-gallery');
            gallery.innerHTML = FACE_SHAPES.map(shape => `
                <div id="face-${shape.id}" 
                    class="step-card face-card border-2 border-gray-200 rounded-xl overflow-hidden cursor-pointer transition duration-150 p-4 hover:bg-gray-50 ${state.selectedFaceShape === shape.id ? 'selected-style' : ''}"
                    onclick="selectFaceShape('${shape.id}')"
                >
                    <h4 class="font-bold text-lg text-gray-800 mb-1">${shape.name}</h4>
                    <p class="text-xs text-gray-500 mb-2">${shape.features}</p>
                    <img src="${shape.img}" alt="${shape.name} è„¸å‹æ¡ˆä¾‹" onerror="this.onerror=null;this.src='https://placehold.co/200x200/cccccc/333333?text=${shape.name}æ¡ˆä¾‹'" class="w-full h-auto object-contain rounded-lg shadow-sm max-h-48">
                </div>
            `).join('');

            // ç¡®ä¿åœ¨æ¸²æŸ“åæ›´æ–°ä¿¡æ¯å¡
            if (state.selectedFaceShape) {
                const selectedShape = FACE_SHAPES.find(s => s.id === state.selectedFaceShape);
                document.getElementById('selected-face-name').textContent = selectedShape.name;
                document.getElementById('selected-face-info').classList.remove('hidden');
            } else {
                 document.getElementById('selected-face-info').classList.add('hidden');
            }
        }

        // 4. é€‰æ‹©è„¸å‹
        function selectFaceShape(id) {
            if (state.selectedFaceShape !== id) {
                 // å¦‚æœæ›´æ¢äº†è„¸å‹ï¼Œæ¸…ç©ºå·²é€‰çš„å‘å‹ï¼Œé¿å…è¯¯å¯¼
                 state.selectedStyleId = null; 
            }
            state.selectedFaceShape = id;

            // é‡æ–°æ¸²æŸ“ç”»å»Šä»¥æ›´æ–°é€‰ä¸­çŠ¶æ€
            renderFaceShapeGallery();
            
            // è§¦å‘æ•´ä½“ App é‡æ–°æ¸²æŸ“ (æ›´æ–°æ­¥éª¤ 3 çš„æç¤ºå’Œå†…å®¹)
            updateApp();
        }

        // 5. é€‰æ‹©å‘å‹
        function selectStyle(id) {
            // ç¡®ä¿åœ¨é€‰æ‹©è„¸å‹åæ‰èƒ½é€‰æ‹©å‘å‹
            if (!state.selectedFaceShape) return; 

            state.selectedStyleId = id;

            // æ¸…é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.style-card').forEach(card => card.classList.remove('selected-style'));

            // è®¾ç½®æ–°çš„é€‰ä¸­çŠ¶æ€
            const selectedCard = document.getElementById(`style-${id}`);
            if (selectedCard) {
                selectedCard.classList.add('selected-style');
            }

            // æ›´æ–°ä¿¡æ¯å¡
            const style = HAIRSTYLES.find(s => s.id === id);
            if (style) {
                document.getElementById('selected-name').textContent = style.name;
                document.getElementById('required-fringe').textContent = `${style.fringe} cm`;
                document.getElementById('required-top').textContent = `${style.top} cm`;
                document.getElementById('required-sides').textContent = `${style.sides} cm`;
                document.getElementById('selected-style-info').classList.remove('hidden');
            }
            
            // è§¦å‘æ•´ä½“ App é‡æ–°æ¸²æŸ“
            updateApp();
        }

        // 6. ç•™é•¿æ—¶é—´è®¡ç®—
        function calculateGrowthTime(style) {
            let resultHTML = '';
            let isReady = true;

            const areas = [
                { key: 'fringe', name: 'åˆ˜æµ·', current: state.currentFringe, required: style.fringe },
                { key: 'top', name: 'é¡¶éƒ¨', current: state.currentTop, required: style.top },
                { key: 'sides', name: 'ä¸¤ä¾§', current: state.currentSides, required: style.sides }
            ];

            const shortAreas = areas.filter(a => a.current < a.required);

            if (shortAreas.length === 0) {
                resultHTML = `<p class="text-green-600 font-bold">ğŸ‰ æ­å–œï¼æ‚¨ç›®å‰çš„å¤´å‘é•¿åº¦è¶³ä»¥å®ç°ã€Œ${style.name}ã€å‘å‹ï¼</p>`;
            } else {
                isReady = false;
                let maxMonths = 0;
                let longestArea = '';

                shortAreas.forEach(a => {
                    const diff = a.required - a.current;
                    const months = Math.ceil(diff / GROWTH_RATE); // å‘ä¸Šå–æ•´
                    
                    if (months > maxMonths) {
                        maxMonths = months;
                        longestArea = a.name;
                    }
                });

                resultHTML = `
                    <p class="text-red-600 font-bold">âš ï¸ æ‚¨çš„å¤´å‘è¿˜ä¸å¤Ÿé•¿ï¼</p>
                    <ul class="list-disc pl-5 mt-2 space-y-1 text-gray-700">
                        ${shortAreas.map(a => `<li>${a.name} (å·® ${ (a.required - a.current).toFixed(1) } cm)</li>`).join('')}
                    </ul>
                    <p class="mt-3 text-lg text-red-700 bg-red-100 p-2 rounded-lg">
                        æ‚¨è¿˜éœ€è¦ç•™é•¿ <span class="font-extrabold">${maxMonths}</span> ä¸ªæœˆ (ä»¥ ${longestArea} ä¸ºå‡†) æ‰èƒ½è¾¾åˆ°ç›®æ ‡é•¿åº¦ã€‚
                    </p>
                `;
            }

            document.getElementById('growth-result').innerHTML = resultHTML;
            return isReady;
        }

        // 7. ç”Ÿæˆç†å‘å¸ˆç®€æŠ¥å¡
        function generateBriefingCard(style) {
            const briefingContent = document.getElementById('briefing-content');
            let briefingText = '';

            const isReady = calculateGrowthTime(style); // å¿…é¡»å…ˆè¿è¡Œè®¡ç®—å™¨

            // å¤´éƒ¨ä¿¡æ¯
            briefingText += `<div class="flex items-center space-x-4 mb-4 border-b pb-4">
                <img src="${style.img}" alt="${style.name}" class="w-16 h-16 object-cover rounded-md border-2 border-blue-200">
                <div>
                    <p class="text-2xl font-extrabold text-blue-700">ç›®æ ‡å‘å‹ï¼š${style.name}</p>
                    <p class="text-sm text-gray-500">ï¼ˆè¯·æŒ‰æ­¤å›¾æ•ˆæœä¿®å‰ªï¼‰</p>
                </div>
            </div>`;

            // è„¸å‹ä¿¡æ¯ï¼ˆå¦‚æœå·²é€‰æ‹©ï¼‰
            if (state.selectedFaceShape) {
                const faceShape = FACE_SHAPES.find(s => s.id === state.selectedFaceShape);
                briefingText += `<div class="mb-3 p-3 bg-purple-50 rounded-lg">
                    <p class="text-sm font-semibold text-purple-700">æˆ‘çš„è„¸å‹: ${faceShape.name}ã€‚è¯·æ ¹æ®æ­¤è„¸å‹å’Œå‘å‹å›¾è¿›è¡Œå¾®è°ƒã€‚</p>
                </div>`;
            }

            // æ²Ÿé€šè¦ç‚¹
            briefingText += `<div class="mb-4">
                <h4 class="text-lg font-bold text-gray-700 mb-2">æ²Ÿé€šè¦ç‚¹ï¼ˆç»™ç†å‘å¸ˆçš„æŒ‡ä»¤ï¼‰:</h4>
                <ul class="list-disc pl-5 space-y-1 text-gray-600">
                    ${style.briefing.map(point => `<li>${point}</li>`).join('')}
                </ul>
            </div>`;

            // é•¿åº¦å¯¹æ¯”
            briefingText += `<div class="mb-4 p-3 bg-white rounded-lg border">
                <h4 class="text-lg font-bold text-gray-700 mb-2">é•¿åº¦æŒ‡ç¤º (Cutting Guide):</h4>
                <div class="grid grid-cols-3 gap-2 text-sm text-center">
                    <div class="font-semibold text-gray-500">åŒºåŸŸ</div>
                    <div class="font-semibold text-gray-500">æ‰€éœ€é•¿åº¦</div>
                    <div class="font-semibold text-gray-500">ç›®å‰é•¿åº¦</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm text-center mt-1 pt-1 border-t">
                    <div class="text-gray-800">åˆ˜æµ·</div>
                    <div class="text-blue-600 font-bold">${style.fringe} cm</div>
                    <div class="${state.currentFringe < style.fringe ? 'text-red-500' : 'text-green-600'}">${state.currentFringe} cm</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm text-center mt-1">
                    <div class="text-gray-800">é¡¶éƒ¨</div>
                    <div class="text-blue-600 font-bold">${style.top} cm</div>
                    <div class="${state.currentTop < style.top ? 'text-red-500' : 'text-green-600'}">${state.currentTop} cm</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm text-center mt-1">
                    <div class="text-gray-800">ä¸¤ä¾§</div>
                    <div class="text-blue-600 font-bold">${style.sides} cm</div>
                    <div class="${state.currentSides < style.sides ? 'text-red-500' : 'text-green-600'}">${state.currentSides} cm</div>
                </div>
            </div>`;

            briefingContent.innerHTML = briefingText;
        }
        
        // 8. æ›´æ–°æ­¥éª¤ 3 çš„è„¸å‹æç¤ºå’Œé”å®šçŠ¶æ€
        function updateStyleGalleryLockState() {
            const faceShape = state.selectedFaceShape ? FACE_SHAPES.find(s => s.id === state.selectedFaceShape) : null;
            const promptElement = document.getElementById('style-gallery-prompt');
            const lockElement = document.getElementById('style-gallery-lock');
            const galleryElement = document.getElementById('style-gallery');

            if (faceShape) {
                // è§£é”
                lockElement.style.display = 'none';
                galleryElement.classList.remove('opacity-30', 'pointer-events-none');
                
                promptElement.classList.remove('bg-red-100', 'border-red-300');
                promptElement.classList.add('bg-green-100', 'border-green-300');
                promptElement.innerHTML = `<p class="text-lg font-bold text-green-700">âœ… è„¸å‹: ${faceShape.name}ã€‚ä»¥ä¸‹æ˜¯ä¸ºæ‚¨æ¨èçš„é€‚é…å‘å‹ï¼š</p>`;
                
                // æ¸²æŸ“è¿‡æ»¤åçš„å‘å‹
                renderStyleGallery();
            } else {
                // é”å®š
                lockElement.style.display = 'flex';
                galleryElement.classList.add('opacity-30', 'pointer-events-none');
                
                promptElement.classList.remove('bg-green-100', 'border-green-300');
                promptElement.classList.add('bg-red-100', 'border-red-300');
                promptElement.innerHTML = `<p class="text-lg font-bold text-red-600">è¯·å…ˆåœ¨ Step 2 ç¡®è®¤æ‚¨çš„è„¸å‹ï¼Œä»¥ä¾¿æ›´å¥½åœ°é€‰æ‹©å‘å‹ã€‚</p>`;
            }
        }


        // 9. ç»Ÿä¸€æ›´æ–°å‡½æ•°
        function updateApp() {
            updateStyleGalleryLockState(); // æ›´æ–° Step 3 é”å®šçŠ¶æ€å’Œæç¤º
            
            // åªæœ‰å½“é€‰æ‹©äº†å‘å‹æ—¶ï¼Œæ‰æ›´æ–°åç»­æ­¥éª¤
            if (state.selectedStyleId) {
                const style = HAIRSTYLES.find(s => s.id === state.selectedStyleId);
                if (style) {
                    generateBriefingCard(style);
                }
            } else {
                // å¦‚æœæ²¡æœ‰é€‰æ‹©å‘å‹ï¼Œæ¸…ç©ºåç»­å†…å®¹
                document.getElementById('briefing-content').innerHTML = '<p class="text-center text-gray-400 py-16">è¯·å®Œæˆå‰é¢æ­¥éª¤ä»¥ç”Ÿæˆä½ çš„ç†å‘ç®€æŠ¥ã€‚</p>';
                document.getElementById('growth-result').innerHTML = '<p>è¯·å…ˆåœ¨ç¬¬ 3 æ­¥ä¸­é€‰æ‹©ä¸€ä¸ªç›®æ ‡å‘å‹ã€‚</p>';
                document.getElementById('selected-style-info').classList.add('hidden');
            }
        }

        // 10. å¤åˆ¶åŠŸèƒ½
        function copyBriefingContent() {
            const style = HAIRSTYLES.find(s => s.id === state.selectedStyleId);
            if (!style) {
                console.log('è¯·å…ˆé€‰æ‹©å‘å‹å¹¶å®Œæˆæ­¥éª¤ï¼'); 
                return;
            }

            const isReady = state.currentFringe >= style.fringe && state.currentTop >= style.top && state.currentSides >= style.sides;
            const growthText = isReady ? 'æ­å–œï¼å¤´å‘é•¿åº¦è¶³å¤Ÿã€‚' : document.getElementById('growth-result').innerText.replace(/\s\s+/g, ' ').trim();
            
            let faceShapeInfo = '';
            if (state.selectedFaceShape) {
                const faceShape = FACE_SHAPES.find(s => s.id === state.selectedFaceShape);
                faceShapeInfo = `\nğŸ‘¤ è„¸å‹å‚è€ƒ: ${faceShape.name}`;
            }

            const textToCopy = `
ã€ç†å‘å¸ˆæ²Ÿé€šç®€æŠ¥ã€‘${faceShapeInfo}

â­ ç›®æ ‡å‘å‹: ${style.name}
---

âœ… æ²Ÿé€šè¦ç‚¹ (è¯·æŒ‰æ­¤ä¿®å‰ª):
- ${style.briefing.join('\n- ')}

ğŸ“ é•¿åº¦æŒ‡ç¤º (å½“å‰ VS æ‰€éœ€):
- åˆ˜æµ·: å½“å‰ ${state.currentFringe} cm / æ‰€éœ€ ${style.fringe} cm
- é¡¶éƒ¨: å½“å‰ ${state.currentTop} cm / æ‰€éœ€ ${style.top} cm
- ä¸¤ä¾§: å½“å‰ ${state.currentSides} cm / æ‰€éœ€ ${style.sides} cm

â±ï¸ ç•™é•¿åˆ†æ:
${growthText}

---
éå£å¤´æ²Ÿé€šï¼Œæ„Ÿè°¢é…åˆï¼
            `.trim();

            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            
            try {
                // ä½¿ç”¨ execCommand è¿›è¡Œå¤åˆ¶ (æ›´å…¼å®¹ iFrame)
                const successful = document.execCommand('copy');
                const msg = successful ? 'ç®€æŠ¥å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼' : 'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚';
                // ç†æƒ³æƒ…å†µä¸‹ä½¿ç”¨è‡ªå®šä¹‰ UI æç¤º
                console.log(msg);
            } catch (err) {
                // ç†æƒ³æƒ…å†µä¸‹ä½¿ç”¨è‡ªå®šä¹‰ UI æç¤º
                console.log('å¤åˆ¶åŠŸèƒ½é”™è¯¯ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡å­—è¿›è¡Œå¤åˆ¶ã€‚');
            }
            document.body.removeChild(tempTextArea);
        }
    </script>
</body>
</html>
